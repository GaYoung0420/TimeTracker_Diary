const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/monthly-BNm71v_F.js","assets/react-vendor-DtX1tuCI.js"])))=>i.map(i=>d[i]);
import{g as e,a as t,j as a,h as n}from"./monthly-BNm71v_F.js";import{a as s,r as o,R as l}from"./react-vendor-DtX1tuCI.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var r={},i=s;r.createRoot=i.createRoot,r.hydrateRoot=i.hydrateRoot;const c={};const d=new Map;function u({event:e,categories:t,onUpdate:n,onDelete:s,onClose:l}){const r=null===e.id,[i,c]=o.useState(e.title||""),[d,u]=o.useState(e.start_time||(e.start?e.start.split("T")[1].substring(0,5):"")),[m,p]=o.useState(e.end_time||(e.end?e.end.split("T")[1].substring(0,5):"")),[h,x]=o.useState(e.category_id),[g,v]=o.useState(e.description||""),[f,y]=o.useState(e.is_plan||!1);e.is_plan;return a.jsx("div",{className:"modal-overlay",onClick:l,children:a.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[a.jsx("h2",{children:r?"ì´ë²¤íŠ¸ ì¶”ê°€":"ì´ë²¤íŠ¸ ìˆ˜ì •"}),a.jsxs("form",{onSubmit:t=>{t.preventDefault();const a=5===d.length?`${d}:00`:d,s=5===m.length?`${m}:00`:m;n(e.id,{title:i,start_time:a,end_time:s,category_id:h,description:g,is_plan:f})},children:[a.jsxs("div",{className:"modal-scroll-content",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ì œëª©"}),a.jsx("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"ì´ë²¤íŠ¸ ì œëª©",required:!0})]}),a.jsxs("div",{className:"form-row",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ì‹œìž‘ ì‹œê°„"}),a.jsx("input",{type:"time",value:d,onChange:e=>u(e.target.value),required:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ì¢…ë£Œ ì‹œê°„"}),a.jsx("input",{type:"time",value:m,onChange:e=>p(e.target.value),required:!0})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ì¹´í…Œê³ ë¦¬"}),a.jsx("select",{value:h,onChange:e=>x(parseInt(e.target.value)),children:t.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))})]}),a.jsx("div",{className:"form-group checkbox-group",children:a.jsxs("label",{className:"checkbox-label",children:[a.jsx("input",{type:"checkbox",checked:f,onChange:e=>y(e.target.checked)}),a.jsx("span",{className:"checkbox-text",children:"ê³„íš ì´ë²¤íŠ¸ë¡œ ì¶”ê°€"})]})}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ì„¤ëª…"}),a.jsx("textarea",{value:g,onChange:e=>v(e.target.value),placeholder:"ì´ë²¤íŠ¸ ì„¤ëª… (ì„ íƒì‚¬í•­)",rows:3})]})]}),a.jsxs("div",{className:"modal-actions",children:[!r&&a.jsx("button",{type:"button",className:"btn-delete",onClick:()=>{window.confirm("ì´ ì´ë²¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&s(e.id)},children:"ì‚­ì œ"}),a.jsxs("div",{className:"modal-actions-right",children:[a.jsx("button",{type:"button",className:"btn-cancel",onClick:l,children:"ì·¨ì†Œ"}),a.jsx("button",{type:"submit",className:"btn-submit",children:r?"ì¶”ê°€":"ì €ìž¥"})]})]})]})]})})}function m({event:e,categories:t,position:n,onUpdate:s,onDelete:l,onClose:r}){const[i,c]=o.useState(e.title),[d,u]=o.useState(e.date||e.start.split("T")[0]),[m,p]=o.useState(e.start_time||e.start.split("T")[1].substring(0,5)),[h,x]=o.useState(e.date||e.end.split("T")[0]),[g,v]=o.useState(e.end_time||e.end.split("T")[1].substring(0,5)),[f,y]=o.useState(e.category_id),j=o.useRef(null);o.useEffect(()=>{var e;const t=null==(e=j.current)?void 0:e.querySelector('input[type="text"]');t&&(t.focus(),t.select())},[]),o.useEffect(()=>{const e=e=>{j.current&&!j.current.contains(e.target)&&b()};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[i,d,m,h,g,f]);const b=()=>{const t=5===m.length?`${m}:00`:m,a=5===g.length?`${g}:00`:g;s(e.id,{title:i,start_time:t,end_time:a,date:d,category_id:f})};return a.jsxs("div",{ref:j,className:"event-edit-popup",style:{position:"absolute",left:`${n.x}px`,top:`${n.y}px`},onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),b()):"Escape"===e.key&&r()},children:[a.jsx("div",{className:"popup-row",children:a.jsx("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"ì´ë²¤íŠ¸ ì œëª©",className:"popup-title-input"})}),a.jsxs("div",{className:"popup-row time-row",children:[a.jsx("label",{style:{fontSize:"12px",color:"#666",width:"30px"},children:"ì‹œìž‘"}),a.jsx("input",{type:"date",value:d,onChange:e=>u(e.target.value),className:"popup-time-input",style:{flex:1.5}}),a.jsx("input",{type:"time",value:m,onChange:e=>p(e.target.value),className:"popup-time-input"})]}),a.jsxs("div",{className:"popup-row time-row",children:[a.jsx("label",{style:{fontSize:"12px",color:"#666",width:"30px"},children:"ì¢…ë£Œ"}),a.jsx("input",{type:"date",value:h,onChange:e=>x(e.target.value),className:"popup-time-input",style:{flex:1.5}}),a.jsx("input",{type:"time",value:g,onChange:e=>v(e.target.value),className:"popup-time-input"})]}),a.jsx("div",{className:"popup-row",children:a.jsx("select",{value:f,onChange:e=>y(parseInt(e.target.value)),className:"popup-category-select",children:t.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))})}),a.jsxs("div",{className:"popup-actions",children:[a.jsx("button",{onClick:()=>{window.confirm("ì´ ì´ë²¤íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&l(e.id)},className:"popup-btn-delete",children:"ì‚­ì œ"}),a.jsx("button",{onClick:b,className:"popup-btn-save",children:"ì €ìž¥"})]})]})}function p({events:t,todos:s,categories:l,todoCategories:r,loading:i,currentDate:c,onCreateEvent:d,onUpdateEvent:p,onDeleteEvent:h,getWakeSleepTimes:x}){const g=40,[v,f]=o.useState(!1),[y,j]=o.useState(null),[b,N]=o.useState(null),[C,S]=o.useState(null),[k,w]=o.useState(null),[_,D]=o.useState(!1),[T,E]=o.useState(!1),[M,$]=o.useState({x:0,y:0}),[I,R]=o.useState(!1),[P,A]=o.useState(null),[z,F]=o.useState(0),[B,L]=o.useState(null),[O,U]=o.useState(null),[W,Y]=o.useState(!1),[q,H]=o.useState(null),[K,G]=o.useState(null),[Q,V]=o.useState(null),[X,Z]=o.useState(null),J=o.useRef(null),ee=o.useRef(null),te=o.useRef(null),ae=o.useRef(null),ne=o.useRef(null),[se,oe]=o.useState(new Date);o.useEffect(()=>{const e=setInterval(()=>{oe(new Date)},6e4);return()=>clearInterval(e)},[]);const le=e=>e.touches&&e.touches.length>0?{clientY:e.touches[0].clientY}:e.changedTouches&&e.changedTouches.length>0?{clientY:e.changedTouches[0].clientY}:{clientY:e.clientY},re=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768,ie=()=>{const e=new Date,t=e.getHours(),a=10*Math.floor(e.getMinutes()/10),n=`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}`,s=`${String(t).padStart(2,"0")}:${String(a+30).padStart(2,"0")}`;w({id:null,title:"",start_time:n,end_time:s,category_id:l.length>0?l[0].id:null,description:"",is_plan:!1}),D(!0)},ce=(t,a)=>{if(re())return;if(W)return;t.stopPropagation(),t.preventDefault();const n=J.current.getBoundingClientRect(),{clientY:s}=le(t),o=s-n.top,l=e(c),[r,i]=a.start.split("T"),[d,u]=i.split(":").map(Number),m=new Date(a.start),p=new Date(a.end),h=Math.round((p-m)/6e4);let x;if(r<l)x=0;else{if(r>l)return;x=60*d+u}const v=o-x/60*g;R(!0),A(a),F(v),L(x),U(h)},de=(t,a,n)=>{if(re())return;t.stopPropagation(),t.preventDefault();const s=e(c),[o,l]=a.start.split("T"),[r,i]=a.end.split("T"),[d,u]=l.split(":").map(Number),[m,p]=i.split(":").map(Number);let h,x;if(o<s)h=0;else{if(o>s)return;h=60*d+u}if(r>s)x=1440+(60*m+p);else{if(r<s)return;x=60*m+p}Y(!0),H(n),G(a),V(h),Z(x),R(!1),A(null)},ue=(e,t)=>{if(re())return;if(e.target.closest(".event-block-absolute"))return;const a=J.current.getBoundingClientRect(),{clientY:n}=le(e),s=n-a.top,o=Math.floor(s/g*60),l=10*Math.round(o/10);f(!0),j(t),N(l),S(l)},me=o.useCallback(e=>W?(ne.current&&cancelAnimationFrame(ne.current),void(ne.current=requestAnimationFrame(()=>{const t=J.current.getBoundingClientRect(),{clientY:a}=le(e),n=a-t.top,s=Math.floor(n/g*60),o=10*Math.round(s/10),l=Math.max(0,Math.min(2880,o));"top"===q?l<X-10&&V(l):"bottom"===q&&l>Q+10&&Z(l)}))):I?(ae.current&&cancelAnimationFrame(ae.current),void(ae.current=requestAnimationFrame(()=>{const t=J.current.getBoundingClientRect(),{clientY:a}=le(e),n=a-t.top,s=Math.floor((n-z)/g*60),o=10*Math.round(s/10),l=Math.max(0,o);B!==l&&L(l)}))):void(v&&(ee.current&&cancelAnimationFrame(ee.current),ee.current=requestAnimationFrame(()=>{const t=J.current.getBoundingClientRect(),{clientY:a}=le(e),n=a-t.top,s=Math.floor(n/g*60),o=10*Math.round(s/10);te.current!==o&&(te.current=o,S(o))}))),[v,I,W,q,Q,X,g,z,B]),pe=o.useCallback(async()=>{if(W&&K){ne.current&&(cancelAnimationFrame(ne.current),ne.current=null);const t=e(c),[a,n]=K.start.split("T"),[s,o]=K.end.split("T");let l={};if("top"===q){let e=Math.floor(Q/60),a=Q%60,n=t;if(Q<0)return Y(!1),H(null),G(null),V(null),void Z(null);l={start_time:`${String(e).padStart(2,"0")}:${String(a).padStart(2,"0")}:00`,date:n}}else if("bottom"===q){let e=Math.floor(X/60),t=X%60;X>=1440&&(e=Math.floor(X/60)-24,t=X%60);l={end_time:`${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}:00`}}try{await p(K.id,l)}catch(k){}return Y(!1),H(null),G(null),V(null),void Z(null)}if(I&&P){ae.current&&(cancelAnimationFrame(ae.current),ae.current=null);const t=e(c),[a]=P.start.split("T"),n=B,s=n+O;if(n<0)return R(!1),A(null),L(null),void U(null);let o=e(c),l=Math.floor(n/60),r=n%60,i=Math.floor(s/60),d=s%60;s>=1440&&(i=Math.floor(s/60)-24,d=s%60);const u=`${String(l).padStart(2,"0")}:${String(r).padStart(2,"0")}:00`,m=`${String(i).padStart(2,"0")}:${String(d).padStart(2,"0")}:00`,[h,x]=P.start.split("T"),[g,v]=x.split(":").map(Number);let f;if(f=h<t?0:60*g+v,n!==f)try{const e={start_time:u,end_time:m,date:o};await p(P.id,e)}catch(k){}return R(!1),A(null),L(null),void U(null)}if(!v)return;ee.current&&(cancelAnimationFrame(ee.current),ee.current=null);const t=Math.min(b,C),a=Math.max(b,C);if(a-t<10)return f(!1),void(te.current=null);const n=Math.floor(t/60),s=t%60,o=Math.floor(a/60),r=a%60,i=`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")}:00`,u=`${String(o).padStart(2,"0")}:${String(r).padStart(2,"0")}:00`,m="plan"===y,h=l.find(e=>e.id)||l[0],x=h?h.id:null;try{const e=await d("ìƒˆ ì´ë²¤íŠ¸",i,u,x,m,"");if(e&&J.current){const a=J.current.getBoundingClientRect(),n=t/60*g,s=a.width/3;w(e),$({x:"plan"===y?s+10:a.width-10,y:n+220}),E(!0)}}catch(k){}f(!1),N(null),S(null),j(null),te.current=null},[v,I,W,P,K,B,Q,X,b,C,y,l,d,p]),he=(t,s=!1)=>{const o=e(c),[l,r]=t.start.split("T"),[i,d]=t.end.split("T");let u,m;if(l<o)u=0;else{if(l>o)return null;{const[e,t]=r.split(":").map(Number);u=60*e+t}}if(i>o)m=1440;else{if(i<o)return null;{const[e,t]=d.split(":").map(Number);m=60*e+t}}const p=m-u;if(p<=0)return null;const h=I&&P&&P.id===t.id;let x,v;W&&K&&K.id===t.id?(x=Q,v=X):h?(x=B,v=B+p):(x=u,v=m);const f=x/60*g,y=(v-x)/60*g,j=(t.category||{color:"#9E9E9E"}).color,b=n(j,h?.6:s?.25:.35),N=r.substring(0,5),C=d.substring(0,5),S=Math.floor(p/60),k=p%60,_=S>0?`${S}ì‹œê°„ ${k}ë¶„`:`${k}ë¶„`,T=p<=30;return a.jsxs("div",{className:"event-block-absolute",style:{background:b,color:"#000",top:`${f}px`,height:`${Math.max(y,20)}px`,cursor:s?"default":h?"grabbing":"grab",opacity:s?.9:h?.8:1,zIndex:h?1e3:1,transition:h?"none":"top 0.1s ease-out",border:s?`2px dashed ${j}`:void 0,padding:T?"1px 4px":"6px 8px",display:"flex",flexDirection:"column",justifyContent:T?"center":"flex-start"},onMouseDown:e=>!s&&ce(e,t),onTouchStart:e=>!s&&ce(e,t),onClick:e=>{I||W||s||((e,t)=>{if(J.current)if(w(e),re())D(!0);else{const e=J.current.getBoundingClientRect(),a=t.clientX-e.left,n=t.clientY-e.top;$({x:a+10>e.width/2?a+150:a+10,y:n+220>e.height?n-30:n+10}),E(!0)}})(t,e)},title:s?`ðŸ“‹ ${t.title}\n${N} - ${C}\n(í• ì¼ ê³„íš)`:`${t.title}\n${N} - ${C}\n${_}`,children:[!s&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"resize-handle resize-handle-top",style:{position:"absolute",top:0,left:0,right:0,height:"6px",cursor:"ns-resize",zIndex:10},onMouseDown:e=>de(e,t,"top"),onTouchStart:e=>de(e,t,"top"),onClick:e=>e.stopPropagation()}),a.jsx("div",{className:"resize-handle resize-handle-bottom",style:{position:"absolute",bottom:0,left:0,right:0,height:"6px",cursor:"ns-resize",zIndex:10},onMouseDown:e=>de(e,t,"bottom"),onTouchStart:e=>de(e,t,"bottom"),onClick:e=>e.stopPropagation()})]}),a.jsxs("div",{className:"event-title",style:{fontSize:T?"10px":"11px",lineHeight:T?"1.1":"1.4",whiteSpace:T?"nowrap":"normal",overflow:"hidden",textOverflow:"ellipsis"},children:[s?"ðŸ“‹ ":"",t.title,T&&a.jsxs("span",{style:{marginLeft:"4px",fontSize:"9px",opacity:.8,fontWeight:"normal"},children:[N,"-",C]})]}),!T&&a.jsxs("div",{className:"event-time",children:[N," - ",C]})]},t.id)},xe=()=>{if(!v)return null;const e=Math.min(b,C),t=Math.max(b,C),n=e/60*g,s=(t-e)/60*g;return a.jsx("div",{className:"event-block-absolute",style:{background:"rgba(66, 133, 244, 0.3)",border:"2px dashed #4285F4",top:`${n}px`,height:`${Math.max(s,20)}px`,pointerEvents:"none"},children:a.jsx("div",{className:"event-title",children:"ìƒˆ ì´ë²¤íŠ¸"})})},ge=o.useMemo(()=>s&&0!==s.length?s.filter(e=>e.scheduled_time).map(t=>{let a=null;if(t.category_id&&(a=l.find(e=>e.id==t.category_id)),!a&&t.todo_category_id&&r){const e=r.find(e=>e.id==t.todo_category_id);e&&e.event_category_id&&(a=l.find(t=>t.id==e.event_category_id))}a||(a={color:"#9E9E9E",name:"ê¸°íƒ€"});const n=e(c);let s=t.scheduled_time;5===s.length&&(s+=":00");const o=parseInt(t.duration)||30,[i,d]=s.split(":").map(Number),u=60*i+d+o,m=Math.floor(u/60)%24,p=u%60,h=`${String(m).padStart(2,"0")}:${String(p).padStart(2,"0")}:00`;return{id:`todo-${t.id}`,title:`ðŸ“ ${t.text}`,start:`${n}T${s}`,end:`${n}T${h}`,category:a,category_id:a.id,is_plan:!0,is_todo:!0}}):[],[s,l,r,c]),{planEvents:ve,actualEvents:fe}=o.useMemo(()=>({planEvents:[...t.filter(e=>!0===e.is_plan),...ge],actualEvents:t.filter(e=>!1===e.is_plan)}),[t,ge]);return i?a.jsx("div",{className:"timeline-wrapper",children:a.jsxs("div",{className:"timeline-loading",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:"ì´ë²¤íŠ¸ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})]})}):a.jsxs(a.Fragment,{children:[(()=>{const{wakeTime:e,sleepTime:t}=x();return a.jsxs("div",{className:"wake-sleep-container",children:[a.jsxs("div",{className:"wake-sleep-item",children:["ðŸŒ… ê¸°ìƒ: ",a.jsx("span",{className:"time-value",children:e})]}),a.jsxs("div",{className:"wake-sleep-item",children:["ðŸŒ™ ì·¨ì¹¨: ",a.jsx("span",{className:"time-value",children:t})]}),a.jsx("button",{className:"add-event-button-mobile",onClick:ie,title:"ì´ë²¤íŠ¸ ì¶”ê°€",children:"âž• ì´ë²¤íŠ¸ ì¶”ê°€"})]})})(),a.jsxs("div",{className:"timeline-grid",children:[a.jsxs("div",{className:"timeline-header",children:[a.jsx("div",{children:"ê³„íš"}),a.jsx("div",{children:"ì‹œê°„"}),a.jsx("div",{children:"ì‹¤ì œ"})]}),a.jsxs("div",{ref:J,className:"timeline-wrapper",style:{minHeight:"960px"},onMouseMove:me,onMouseUp:pe,onTouchMove:me,onTouchEnd:pe,onMouseLeave:()=>{ee.current&&(cancelAnimationFrame(ee.current),ee.current=null),ae.current&&(cancelAnimationFrame(ae.current),ae.current=null),ne.current&&(cancelAnimationFrame(ne.current),ne.current=null),f(!1),R(!1),A(null),L(null),U(null),Y(!1),H(null),G(null),V(null),Z(null),te.current=null},children:[a.jsxs("div",{className:"timeline-columns",children:[a.jsxs("div",{className:"timeline-column plan-column",onMouseDown:e=>ue(e,"plan"),onTouchStart:e=>ue(e,"plan"),children:[ve.map(e=>he(e,e.is_todo)),v&&"plan"===y&&xe()]}),a.jsx("div",{className:"timeline-column time-column"}),a.jsxs("div",{className:"timeline-column actual-column",onMouseDown:e=>ue(e,"actual"),onTouchStart:e=>ue(e,"actual"),children:[fe.map(e=>he(e,!1)),v&&"actual"===y&&xe()]})]}),a.jsx("div",{className:"time-markers",children:Array.from({length:24},(e,t)=>{const{wakeTime:n,sleepTime:s}=x(),o=(n&&"-"!==n?parseInt(n.split(":")[0]):null)===t,l=(s&&"-"!==s?parseInt(s.split(":")[0]):null)===t,r={color:o?"#e03131":l?"#1971c2":void 0,fontWeight:o||l?"bold":void 0,fontSize:o||l?16:void 0};return a.jsxs("div",{className:"time-marker-row",style:{height:"40px"},children:[a.jsx("div",{}),a.jsx("div",{className:"time-marker-label",style:r,children:String(t).padStart(2,"0")}),a.jsx("div",{})]},t)})}),e(c)===e(se)&&a.jsx("div",{className:"current-time-indicator",style:{position:"absolute",top:(60*se.getHours()+se.getMinutes())/60*g+"px",left:0,right:0,height:"2px",backgroundColor:"red",opacity:.2,zIndex:20,pointerEvents:"none"},children:a.jsx("div",{style:{position:"absolute",left:"-5px",top:"-4px",width:"10px",height:"10px",borderRadius:"50%",backgroundColor:"red"}})})]})]}),T&&k&&a.jsx(m,{event:k,categories:l,position:M,onUpdate:async(e,t)=>{try{await p(e,t),E(!1),w(null)}catch(a){}},onDelete:async e=>{try{await h(e),E(!1),w(null)}catch(t){}},onClose:()=>{E(!1),w(null)}}),_&&k&&a.jsx(u,{event:k,categories:l,onUpdate:async(e,t)=>{try{if(null===e){const{title:e,start_time:a,end_time:n,category_id:s,description:o,is_plan:l}=t;await d(e,a,n,s,l,o)}else await p(e,t);D(!1),w(null)}catch(a){}},onDelete:async e=>{try{await h(e),D(!1),w(null)}catch(t){}},onClose:()=>{D(!1),w(null)}})]})}const h=1500;function x({todoText:e,pomodoroCount:t,onComplete:n,onClose:s}){const[l,r]=o.useState(h),[i,c]=o.useState(!1),[d,u]=o.useState(!1),[m,p]=o.useState(!1),[x,g]=o.useState(!1),v=o.useRef(null),f=o.useRef(null);o.useEffect(()=>(i&&!d?v.current=setInterval(()=>{r(e=>e<=1?(clearInterval(v.current),c(!1),n(),h):e-1)},1e3):v.current&&clearInterval(v.current),()=>{v.current&&clearInterval(v.current)}),[i,d,n]),o.useEffect(()=>{if(f.current){const e=document.createElement("canvas");e.width=400,e.height=200;const t=e.getContext("2d"),a=()=>{t.clearRect(0,0,e.width,e.height),t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),t.fillStyle="#333333",t.font="bold 64px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText(y(l),e.width/2,e.height/2),x&&requestAnimationFrame(a)};if(x){const t=e.captureStream(30);f.current.srcObject=t,a()}}},[l,x]);const y=e=>{const t=Math.floor(e/60),a=e%60;return`${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}`},j=()=>{c(!1),u(!1),r(h)},b=(h-l)/h*100;return a.jsx("div",{className:"pomodoro-overlay",children:a.jsxs("div",{className:"pomodoro-modal "+(m?"fullscreen":""),children:[a.jsx("button",{className:"pomodoro-close",onClick:s,children:"Ã—"}),a.jsxs("div",{className:"pomodoro-header",children:[a.jsx("div",{className:"pomodoro-todo-title",children:e}),a.jsxs("div",{className:"pomodoro-count-display",children:["ì™„ë£Œí•œ ë½€ëª¨ë„ë¡œ: ",t,"ê°œ ðŸ…"]})]}),a.jsxs("div",{className:"pomodoro-circle-container",children:[a.jsxs("svg",{className:"pomodoro-circle",viewBox:"0 0 200 200",children:[a.jsx("circle",{cx:"100",cy:"100",r:"90",fill:"none",stroke:"#e0e0e0",strokeWidth:"10"}),a.jsx("circle",{cx:"100",cy:"100",r:"90",fill:"none",stroke:"#ff6b6b",strokeWidth:"10",strokeDasharray:""+2*Math.PI*90,strokeDashoffset:""+2*Math.PI*90*(1-b/100),transform:"rotate(-90 100 100)",style:{transition:"stroke-dashoffset 1s linear"}})]}),a.jsx("div",{className:"pomodoro-time",children:y(l)})]}),a.jsx("div",{className:"pomodoro-controls",children:i?d?a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"pomodoro-btn pomodoro-btn-primary",onClick:()=>{u(!1)},children:"ìž¬ê°œ"}),a.jsx("button",{className:"pomodoro-btn pomodoro-btn-secondary",onClick:j,children:"ì´ˆê¸°í™”"})]}):a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"pomodoro-btn pomodoro-btn-secondary",onClick:()=>{u(!0)},children:"ì¼ì‹œì •ì§€"}),a.jsx("button",{className:"pomodoro-btn pomodoro-btn-secondary",onClick:j,children:"ì´ˆê¸°í™”"})]}):a.jsx("button",{className:"pomodoro-btn pomodoro-btn-primary",onClick:()=>{c(!0),u(!1)},children:"ì‹œìž‘"})}),a.jsxs("div",{className:"pomodoro-actions",children:[a.jsx("button",{className:"pomodoro-action-btn",onClick:()=>{p(!m)},children:m?"ì¢…ë£Œ":"ì „ì²´í™”ë©´"}),a.jsx("button",{className:"pomodoro-action-btn",onClick:async()=>{if(!x&&f.current)try{f.current.readyState<2&&await new Promise(e=>{f.current.onloadedmetadata=e}),await f.current.requestPictureInPicture(),g(!0)}catch(e){}else document.pictureInPictureElement&&(await document.exitPictureInPicture(),g(!1))},children:x?"PIP ì¢…ë£Œ":"PIP"})]}),a.jsx("video",{ref:f,style:{display:"none"},autoPlay:!0,muted:!0,playsInline:!0})]})})}function g({todos:e,categories:n,todoCategories:s,currentDate:l,onAdd:r,onUpdate:i,onDelete:c,onReorder:d,onOpenTodoCategoryManager:u}){var m,p;const[h,g]=o.useState(""),[v,f]=o.useState(!1),[y,j]=o.useState(null),[b,N]=o.useState(null),[C,S]=o.useState(""),[k,w]=o.useState(""),[_,D]=o.useState(null),[T,E]=o.useState(""),[M,$]=o.useState(null),[I,R]=o.useState(null),[P,A]=o.useState(""),[z,F]=o.useState(""),[B,L]=o.useState(null),[O,U]=o.useState(null),W=e=>{if(!l||e.completed)return!1;const t=new Date;t.setHours(0,0,0,0);const a=new Date(l);return a.setHours(0,0,0,0),a<t},Y=()=>{h.trim()&&(r(h.trim(),null,b,C||null,k?parseInt(k):null),g(""),j(null),N(null),S(""),w(""),f(!1))},q=e=>{T.trim()&&i(e,{text:T.trim(),category_id:M,todo_category_id:I,scheduled_time:P||null,duration:z?parseInt(z):null}),D(null),E(""),$(null),R(null),A(""),F("")},H=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},K=()=>{L(null)},G=[...e].sort((e,t)=>e.order-t.order),Q=e=>n.find(t=>t.id===e),V=e=>null==s?void 0:s.find(t=>t.id===e),X=async(e,a)=>{if(a)try{const n=await t.completeTodo(e);n.success&&n.event?window.location.reload():i(e,{completed:a})}catch(n){i(e,{completed:a})}else i(e,{completed:a})};return a.jsxs("div",{className:"todo-container",children:[a.jsxs("div",{className:"section-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("span",{children:"âœ… ì˜¤ëŠ˜ í•  ì¼"}),a.jsx("button",{className:"btn-category-settings-small",onClick:u,title:"íˆ¬ë‘ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬",children:"âš™ï¸"})]}),a.jsxs("div",{className:"todo-input-group",style:{position:"relative"},children:[a.jsx("input",{type:"text",className:"todo-input",placeholder:"í•  ì¼ì„ ìž…ë ¥í•˜ì„¸ìš”...",value:h,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"===e.key&&Y()}}),a.jsx("button",{className:"btn-settings-popup",onClick:()=>f(!v),style:{background:v?"#f0f0f0":"white",border:"1px solid #e9e9e7",borderRadius:"4px",cursor:"pointer",fontSize:"16px",color:"#666",padding:"0 10px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},title:"ìƒì„¸ ì„¤ì •",children:"âž•"}),a.jsx("button",{className:"btn",onClick:Y,children:"ì¶”ê°€"}),v&&a.jsxs("div",{className:"todo-settings-popup",style:{position:"absolute",top:"100%",right:"0",marginTop:"8px",background:"white",border:"1px solid #e0e0e0",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"16px",zIndex:100,width:"280px"},children:[a.jsxs("div",{style:{marginBottom:"12px"},children:[a.jsx("label",{style:{display:"block",fontSize:"12px",color:"#666",marginBottom:"4px"},children:"íˆ¬ë‘ ì¹´í…Œê³ ë¦¬"}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:s&&s.length>0?s.map(e=>a.jsx("button",{className:"category-chip-small "+(b===e.id?"selected":""),style:{backgroundColor:b===e.id?e.color||"#4a9eff":"#f0f0f0",color:"#37352f",border:"none",padding:"4px 8px",borderRadius:"4px",fontSize:"11px",cursor:"pointer"},onClick:()=>N(b===e.id?null:e.id),children:e.name},e.id)):a.jsx("div",{style:{fontSize:"11px",color:"#999"},children:"ì¹´í…Œê³ ë¦¬ ì—†ìŒ"})})]}),a.jsxs("div",{style:{marginBottom:"12px"},children:[a.jsx("label",{style:{display:"block",fontSize:"12px",color:"#666",marginBottom:"4px"},children:"ì‹œìž‘ ì‹œê°„"}),a.jsx("input",{type:"time",value:C,onChange:e=>S(e.target.value),style:{width:"100%",padding:"6px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"12px"}})]}),a.jsxs("div",{children:[a.jsx("label",{style:{display:"block",fontSize:"12px",color:"#666",marginBottom:"4px"},children:"ì†Œìš” ì‹œê°„ (ë¶„)"}),a.jsx("input",{type:"number",value:k,onChange:e=>w(e.target.value),placeholder:"30",min:"1",style:{width:"100%",padding:"6px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"12px"}})]})]})]}),a.jsx("ul",{className:"todo-list",children:0===G.length?a.jsx("li",{style:{textAlign:"left",fontSize:"13px",color:"#9b9a97",padding:"8px 0",listStyle:"none"},children:"í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤"}):G.map(t=>{return a.jsxs("li",{className:"todo-item "+((null==B?void 0:B.id)===t.id?"dragging":""),draggable:_!==t.id,onDragStart:e=>((e,t)=>{L(t),e.dataTransfer.effectAllowed="move"})(e,t),onDragOver:H,onDrop:a=>((t,a)=>{if(t.preventDefault(),!B||B.id===a.id)return void L(null);const n=[...e].sort((e,t)=>e.order-t.order),s=n.findIndex(e=>e.id===B.id),o=n.findIndex(e=>e.id===a.id);if(-1===s||-1===o)return void L(null);const l=[...n],[r]=l.splice(s,1);l.splice(o,0,r);const i=l.map((e,t)=>({id:e.id,order:t}));d(i),L(null)})(a,t),onDragEnd:K,children:[a.jsx("span",{className:"todo-drag-handle",children:"â‹®"}),W(t)?a.jsx("div",{className:"todo-checkbox overdue-arrow",onClick:()=>X(t.id,!t.completed),style:{width:"20px",height:"20px",cursor:"pointer",flexShrink:0,margin:0,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #999",borderRadius:"3px",fontSize:"14px",color:"#fe7f65ff",background:"#fff",userSelect:"none",fontWeight:"bold"},title:"ë¯¸ì™„ë£Œ (í´ë¦­í•˜ì—¬ ì™„ë£Œ)",children:"â†’"}):a.jsx("input",{type:"checkbox",className:"todo-checkbox",checked:t.completed,onChange:()=>X(t.id,!t.completed)}),_===t.id?a.jsxs("div",{className:"todo-edit-card compact",children:[a.jsxs("div",{className:"todo-edit-top-row",children:[a.jsx("input",{type:"text",className:"todo-edit-input-compact",value:T,onChange:e=>E(e.target.value),onKeyDown:e=>{"Enter"===e.key&&q(t.id)},autoFocus:!0,placeholder:"í•  ì¼ ìž…ë ¥"}),a.jsx("button",{className:"btn-save-compact",onClick:()=>q(t.id),children:"ì €ìž¥"})]}),a.jsxs("div",{className:"todo-edit-bottom-row",children:[a.jsx("div",{className:"todo-category-scroll",children:s&&s.length>0?s.map(e=>a.jsx("button",{className:"category-chip-micro "+(I===e.id?"selected":""),style:I===e.id?{backgroundColor:e.color||"#4a9eff",color:"#37352f",borderColor:e.color||"#4a9eff"}:{},onClick:t=>{t.stopPropagation(),R(I===e.id?null:e.id)},title:e.name,children:e.name},e.id)):a.jsx("span",{className:"no-cat-msg",children:"ì¹´í…Œê³ ë¦¬ ì—†ìŒ"})}),a.jsxs("div",{className:"todo-time-compact-group",children:[a.jsx("input",{type:"time",className:"todo-edit-time-compact",value:P,onChange:e=>A(e.target.value),title:"ì‹œìž‘ ì‹œê°„"}),a.jsxs("div",{className:"duration-wrapper",children:[a.jsx("input",{type:"number",className:"todo-edit-duration-compact",value:z,onChange:e=>F(e.target.value),placeholder:"ë¶„",title:"ì†Œìš” ì‹œê°„(ë¶„)"}),a.jsx("span",{className:"unit-text",children:"m"})]})]})]})]}):a.jsxs("div",{className:"todo-content",children:[a.jsxs("span",{className:"todo-text "+(t.completed?"completed":""),onDoubleClick:()=>(e=>{D(e.id),E(e.text),$(e.category_id||null),R(e.todo_category_id||null),A(e.scheduled_time||""),F(e.duration||"")})(t),children:[t.text,t.scheduled_time&&a.jsxs("span",{style:{marginLeft:"8px",fontSize:"11px",color:"#666"},children:["â° ",t.scheduled_time.slice(0,5)]}),t.duration&&a.jsxs("span",{style:{marginLeft:"4px",fontSize:"11px",color:"#666"},children:["(",t.duration,"ë¶„)"]})]}),t.category_id&&Q(t.category_id)&&a.jsx("span",{className:"todo-category-badge",style:{backgroundColor:Q(t.category_id).color,color:"#37352f"},children:Q(t.category_id).name}),t.todo_category_id&&V(t.todo_category_id)&&a.jsx("span",{className:"todo-category-badge",style:{backgroundColor:V(t.todo_category_id).color||"#4a9eff",color:"#37352f"},children:V(t.todo_category_id).name}),(n=t.pomodoro_count,n&&0!==n?a.jsx("div",{className:"pomodoro-tomatoes",style:{display:"flex",gap:"4px",marginLeft:"8px"},children:Array.from({length:n}).map((e,t)=>a.jsx("img",{src:"/assets/pomo-BNnBQd7t.svg",alt:"pomodoro",width:"20",height:"20",style:{display:"block"}},t))}):null),a.jsx("button",{className:"pomodoro-start-btn",onClick:()=>{return e=t.id,void U(e);var e},title:"ë½€ëª¨ë„ë¡œ ì‹œìž‘",children:"ðŸ…"})]}),a.jsx("button",{className:"todo-delete",onClick:()=>c(t.id),children:"Ã—"})]},t.id);var n})}),O&&a.jsx(x,{todoId:O,todoText:(null==(m=G.find(e=>e.id===O))?void 0:m.text)||"",pomodoroCount:(null==(p=G.find(e=>e.id===O))?void 0:p.pomodoro_count)||0,onComplete:()=>(async e=>{try{(await t.incrementPomodoro(e)).success&&i(e,{})}catch(a){}})(O),onClose:()=>{U(null)}})]})}function v({routines:e,routineChecks:t,onToggle:n,onAdd:s,onUpdate:l,onDelete:r,onReorder:i}){const[c,d]=o.useState(""),[u,m]=o.useState(!1),[p,h]=o.useState(null),[x,g]=o.useState(""),[v,f]=o.useState(null),y=()=>{c.trim()&&(s(c.trim()),d(""),m(!1))},j=()=>{x.trim()&&l(p,{text:x.trim()}),h(null),g("")},b=()=>{h(null),g("")},N=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},C=()=>{f(null)},S=[...e].sort((e,t)=>e.order-t.order);return a.jsxs("div",{className:"routine-container",children:[a.jsxs("div",{className:"section-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx("span",{children:"ðŸ” ì˜¤ëŠ˜ì˜ ë£¨í‹´"}),a.jsx("button",{className:"btn-category-settings-small",onClick:()=>m(!0),title:"ìƒˆ ë£¨í‹´ ì¶”ê°€",children:"+"})]}),a.jsx("div",{className:"routine-grid",children:0===S.length?a.jsx("div",{style:{fontSize:"13px",color:"#9b9a97"},children:"ë£¨í‹´ì´ ì—†ìŠµë‹ˆë‹¤"}):S.map(s=>{const o=t[s.id]||!1,l=p===s.id;return a.jsx("div",{className:`routine-card ${o?"completed":""} ${(null==v?void 0:v.id)===s.id?"dragging":""}`,onClick:()=>!l&&n(s.id,!o),draggable:!l,onDragStart:e=>((e,t)=>{f(t),e.dataTransfer.effectAllowed="move"})(e,s),onDragOver:N,onDrop:t=>((t,a)=>{if(t.preventDefault(),!v||v.id===a.id)return void f(null);const n=[...e].sort((e,t)=>e.order-t.order),s=n.findIndex(e=>e.id===v.id),o=n.findIndex(e=>e.id===a.id);if(-1===s||-1===o)return void f(null);const l=[...n],[r]=l.splice(s,1);l.splice(o,0,r);const c=l.map((e,t)=>({id:e.id,order:t}));i(c),f(null)})(t,s),onDragEnd:C,children:l?a.jsxs("div",{className:"routine-edit-mode",onClick:e=>e.stopPropagation(),children:[a.jsx("input",{type:"text",className:"routine-edit-input",value:x,onChange:e=>g(e.target.value),onKeyPress:e=>{"Enter"===e.key&&j(),"Escape"===e.key&&b()},autoFocus:!0}),a.jsxs("div",{className:"routine-edit-actions",children:[a.jsx("button",{className:"routine-edit-btn save",onClick:j,children:"âœ“"}),a.jsx("button",{className:"routine-edit-btn cancel",onClick:b,children:"âœ•"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"routine-title",children:s.text}),a.jsxs("div",{className:"routine-actions",children:[a.jsx("button",{className:"routine-action-btn edit",onClick:e=>((e,t)=>{t.stopPropagation(),h(e.id),g(e.text)})(s,e),title:"ìˆ˜ì •",children:"âœŽ"}),a.jsx("button",{className:"routine-action-btn delete",onClick:e=>((e,t)=>{t.stopPropagation(),confirm("ì´ ë£¨í‹´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&r(e)})(s.id,e),title:"ì‚­ì œ",children:"Ã—"})]}),a.jsx("div",{className:"routine-check",children:o?"âœ“":""})]})},s.id)})}),u&&a.jsx("div",{className:"modal-overlay",onClick:()=>m(!1),children:a.jsxs("div",{className:"modal-content",onClick:e=>e.stopPropagation(),style:{maxWidth:"400px"},children:[a.jsx("h3",{style:{marginTop:0,marginBottom:"16px"},children:"ìƒˆ ë£¨í‹´ ì¶”ê°€"}),a.jsx("div",{className:"form-group",children:a.jsx("input",{type:"text",className:"routine-input",placeholder:"ë£¨í‹´ ì´ë¦„ ìž…ë ¥...",value:c,onChange:e=>d(e.target.value),onKeyPress:e=>{"Enter"===e.key&&y()},autoFocus:!0,style:{width:"100%",padding:"8px",marginBottom:"16px",border:"1px solid #ddd",borderRadius:"4px",boxSizing:"border-box"}})}),a.jsxs("div",{className:"form-actions",style:{display:"flex",justifyContent:"flex-end",gap:"8px"},children:[a.jsx("button",{className:"btn-cancel",onClick:()=>m(!1),style:{padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",background:"#b4b4b4ff"},children:"ì·¨ì†Œ"}),a.jsx("button",{className:"btn-save",onClick:y,style:{padding:"8px 16px",border:"none",borderRadius:"4px",cursor:"pointer",background:"#4CAF50",color:"white"},children:"ì¶”ê°€"})]})]})})]})}function f({selectedMood:e,onSelect:t}){return a.jsxs("div",{className:"mood-container",children:[a.jsx("div",{className:"section-header",children:"ðŸ˜Š ì˜¤ëŠ˜ì˜ ê¸°ë¶„"}),a.jsx("div",{className:"mood-selector",children:[{value:"bad",emoji:"ðŸ˜¢",label:"Bad"},{value:"soso",emoji:"ðŸ˜",label:"So-So"},{value:"good",emoji:"ðŸ˜Š",label:"Good"}].map(n=>a.jsxs("button",{className:"mood-btn "+(e===n.value?"selected":""),"data-mood":n.value,onClick:()=>t(n.value),children:[a.jsx("span",{className:"mood-emoji",children:n.emoji}),a.jsx("span",{className:"mood-label",children:n.label})]},n.value))})]})}const y="âœ¦[ì‹¤ì œ] ì˜¤ëŠ˜ ì‹¤ì œë¡œ í•œ ê²ƒ: :\nâœ§[ì—ë„ˆì§€] 0~10 ì¤‘:\nâœ§[ì¹­ì°¬] ì¹­ì°¬í•˜ê¸° :\n-------------------\nâœ§Keep           :\nâœ¦Problem        :\nâœ§TRY      :\n";function j({value:e,onSave:t}){const[n,s]=o.useState(e||y);o.useEffect(()=>{s(e||y)},[e]);return a.jsxs("div",{className:"reflection-container",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("span",{children:"ðŸ“ ì˜¤ëŠ˜ì˜ íšŒê³ "}),n!==y&&a.jsx("button",{className:"template-btn",onClick:()=>{s(y)},title:"ê¸°ë³¸ í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°",children:"ðŸ“‹ í…œí”Œë¦¿"})]}),a.jsx("textarea",{className:"reflection-textarea",placeholder:"ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ëŒì•„ë³´ë©°...",value:n,onChange:e=>s(e.target.value)}),a.jsx("button",{className:"btn",style:{marginTop:"12px",width:"100%"},onClick:()=>{t(n),alert("íšŒê³ ê°€ ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤!")},children:"ì €ìž¥í•˜ê¸°"})]})}function b({currentDate:t,images:n,onImageUploaded:s,onImageDeleted:l}){const[r,i]=o.useState(!1),c=e(t);return a.jsxs("div",{className:"image-upload-section",children:[a.jsx("div",{className:"section-header",children:"ðŸ“· ì˜¤ëŠ˜ì˜ ì‚¬ì§„"}),a.jsxs("div",{className:"images-grid",children:[n&&n.length>0&&n.map(e=>a.jsxs("div",{className:"image-item",children:[a.jsx("img",{src:e.view_url,alt:e.file_name,className:"image-thumbnail"}),a.jsx("button",{className:"image-delete-btn",onClick:()=>(async e=>{if(confirm("ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{const t=await fetch(`/api/images/${e}`,{method:"DELETE"}),a=await t.json();a.success?l(e):alert("ì‚­ì œ ì‹¤íŒ¨: "+a.error)}catch(t){alert("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}})(e.id),title:"ì‚­ì œ",children:"Ã—"})]},e.id)),a.jsxs("label",{className:"image-upload-card",children:[a.jsx("div",{className:"upload-icon",children:"+"}),a.jsx("div",{className:"upload-text",children:r?"ì—…ë¡œë“œ ì¤‘...":"ì‚¬ì§„ ì¶”ê°€"}),a.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:async e=>{const t=Array.from(e.target.files);if(0!==t.length){for(const e of t){if(!e.type.startsWith("image/"))return void alert("ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.");if(e.size>5242880)return void alert(`${e.name}: íŒŒì¼ í¬ê¸°ëŠ” 5MBë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)}i(!0);try{for(const e of t){const t=new FormData;t.append("image",e),t.append("date",c);const a=await fetch("/api/images/upload",{method:"POST",body:t}),n=await a.json();if(!n.success){alert(`${e.name} ì—…ë¡œë“œ ì‹¤íŒ¨: ${n.error}`);break}s(n.data)}e.target.value=""}catch(a){alert("ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{i(!1)}}},disabled:r,style:{display:"none"}})]})]})]})}function N({events:e,categories:t,onOpenSettings:n,currentDate:s}){const o=(()=>{const a={};t&&t.length>0&&t.forEach(e=>{a[e.id]={name:e.name,hours:0,color:e.color}});const n=e.filter(e=>!1===e.is_plan),o=e=>{if(!e)return new Date;const t=e.split(/[+Z]/)[0];return new Date(t)},l=new Date(s);l.setHours(0,0,0,0);const r=new Date(s);return r.setHours(23,59,59,999),n&&n.length>0&&n.forEach(e=>{const t=e.category_id;if(t&&a[t]){const n=o(e.start),s=o(e.end),i=n>l?n:l,c=s<r?s:r;if(c>i){const e=(c-i)/36e5;a[t].hours+=e}}}),a})(),l=t||[];return a.jsxs("div",{className:"category-stats-container",children:[a.jsxs("div",{className:"section-header",children:[a.jsx("span",{children:"ðŸ“Š ì¹´í…Œê³ ë¦¬ë³„ ì‹œê°„ (ì‹¤ì œ)"}),a.jsx("button",{className:"btn-category-settings-small",onClick:n,title:"ì¹´í…Œê³ ë¦¬ ê´€ë¦¬",children:"âš™ï¸"})]}),a.jsx("div",{className:"category-matrix-wrapper",children:a.jsxs("table",{className:"category-matrix",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{}),l.map(e=>a.jsx("th",{style:{borderBottom:`3px solid ${e.color}`,color:"#37352f"},children:e.name},e.id))]})}),a.jsx("tbody",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"ì‹œê°„"}),l.map(e=>a.jsx("td",{style:{borderBottom:`3px solid ${e.color}`,color:"#37352f"},children:a.jsxs("span",{className:"category-time",children:[o[e.id]?o[e.id].hours.toFixed(1):"0.0","h"]})},e.id))]})})]})})]})}function C({categories:e,onCategoriesChange:n}){const[s,l]=o.useState(!1),[r,i]=o.useState(null),[c,d]=o.useState(""),[u,m]=o.useState("#16a765"),[p,h]=o.useState(""),[x,g]=o.useState(""),v=()=>{i(null),h(""),g("")};return a.jsxs("div",{className:"category-manager",children:[a.jsxs("div",{className:"category-manager-header",children:[a.jsx("h3",{children:"ì¹´í…Œê³ ë¦¬ ê´€ë¦¬"}),!s&&a.jsx("button",{className:"btn-add-category",onClick:()=>l(!0),children:"+ ì¶”ê°€"})]}),s&&a.jsxs("div",{className:"category-form",children:[a.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"ì¹´í…Œê³ ë¦¬ ì´ë¦„",className:"category-name-input"}),a.jsx("input",{type:"color",value:u,onChange:e=>m(e.target.value),className:"category-color-picker"}),a.jsxs("div",{className:"category-form-actions",children:[a.jsx("button",{className:"btn-save",onClick:async()=>{if(c.trim())try{const e=await t.createCategory(c.trim(),u);e.success?(n(),d(""),m("#16a765"),l(!1)):alert("ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì‹¤íŒ¨: "+e.error)}catch(e){alert("ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},children:"ì €ìž¥"}),a.jsx("button",{className:"btn-cancel",onClick:()=>{l(!1),d(""),m("#16a765")},children:"ì·¨ì†Œ"})]})]}),a.jsx("div",{className:"category-list",children:e&&e.length>0?e.map(e=>a.jsx("div",{className:"category-item",children:r===e.id?a.jsxs("div",{className:"category-form",children:[a.jsx("input",{type:"text",value:p,onChange:e=>h(e.target.value),className:"category-name-input"}),a.jsx("input",{type:"color",value:x,onChange:e=>g(e.target.value),className:"category-color-picker"}),a.jsxs("div",{className:"category-form-actions",children:[a.jsx("button",{className:"btn-save",onClick:()=>(async e=>{if(p.trim())try{const a=await t.updateCategory(e,{name:p.trim(),color:x});a.success?(n(),i(null),h(""),g("")):alert("ì¹´í…Œê³ ë¦¬ ìˆ˜ì • ì‹¤íŒ¨: "+a.error)}catch(a){alert("ì¹´í…Œê³ ë¦¬ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}})(e.id),children:"ì €ìž¥"}),a.jsx("button",{className:"btn-cancel",onClick:v,children:"ì·¨ì†Œ"})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"category-info",children:[a.jsx("span",{className:"category-color-box",style:{backgroundColor:e.color}}),a.jsx("span",{className:"category-name",children:e.name})]}),a.jsxs("div",{className:"category-actions",children:[a.jsx("button",{className:"btn-edit",onClick:()=>{return i((t=e).id),h(t.name),void g(t.color);var t},children:"ìˆ˜ì •"}),a.jsx("button",{className:"btn-delete",onClick:()=>(async e=>{if(window.confirm("ì´ ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì‚¬ìš© ì¤‘ì¸ ì¹´í…Œê³ ë¦¬ëŠ” ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤)"))try{const a=await t.deleteCategory(e);a.success?n():alert("ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì‹¤íŒ¨: "+a.error)}catch(a){alert("ì¹´í…Œê³ ë¦¬ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}})(e.id),children:"ì‚­ì œ"})]})]})},e.id)):a.jsx("div",{className:"no-categories",children:"ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤. ì¶”ê°€í•´ì£¼ì„¸ìš”."})})]})}function S({todoCategories:e,eventCategories:t,onAdd:n,onUpdate:s,onDelete:l}){const[r,i]=o.useState(!1),[c,d]=o.useState(""),[u,m]=o.useState(null),[p,h]=o.useState("#4a9eff"),[x,g]=o.useState(null),[v,f]=o.useState(""),[y,j]=o.useState(null),[b,N]=o.useState("#4a9eff"),C=()=>{v.trim()&&(s(x,v.trim(),y,b),g(null),f(""),j(null),N("#4a9eff"))},S=()=>{g(null),f(""),j(null)},k=e=>null==t?void 0:t.find(t=>t.id===e);return a.jsxs("div",{className:"category-manager",children:[a.jsxs("div",{className:"category-manager-header",children:[a.jsx("h3",{children:"íˆ¬ë‘ ì¹´í…Œê³ ë¦¬ ê´€ë¦¬"}),a.jsx("button",{className:"btn-add",onClick:()=>i(!0),children:"+ ì¶”ê°€"})]}),r&&a.jsxs("div",{className:"category-edit-form",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ì¹´í…Œê³ ë¦¬ ì´ë¦„"}),a.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),placeholder:"ì˜ˆ: ê°œì¸, ì—…ë¬´, í•™ìŠµ...",autoFocus:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ìƒ‰ìƒ"}),a.jsxs("div",{className:"color-picker-wrapper",style:{display:"flex",alignItems:"center",gap:"8px"},children:[a.jsx("input",{type:"color",value:p,onChange:e=>h(e.target.value),style:{width:"40px",height:"40px",padding:"0",border:"none",cursor:"pointer"}}),a.jsx("span",{className:"color-value",style:{fontSize:"13px",color:"#666"},children:p})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ì—°ê²°í•  ì´ë²¤íŠ¸ ì¹´í…Œê³ ë¦¬ (ì„ íƒ)"}),a.jsxs("select",{value:u||"",onChange:e=>m(e.target.value?parseInt(e.target.value):null),children:[a.jsx("option",{value:"",children:"-- ì„ íƒ ì•ˆ í•¨ --"}),null==t?void 0:t.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{className:"btn-save",onClick:()=>{c.trim()&&(n(c.trim(),u,p),d(""),m(null),h("#4a9eff"),i(!1))},children:"ì €ìž¥"}),a.jsx("button",{className:"btn-cancel",onClick:()=>{i(!1),d(""),m(null)},children:"ì·¨ì†Œ"})]})]}),a.jsx("div",{className:"todo-category-list",children:0===(null==e?void 0:e.length)?a.jsx("div",{className:"empty-state",children:"íˆ¬ë‘ ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤"}):null==e?void 0:e.map(e=>x===e.id?a.jsxs("div",{className:"category-edit-form",children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ì¹´í…Œê³ ë¦¬ ì´ë¦„"}),a.jsx("input",{type:"text",value:v,onChange:e=>f(e.target.value),autoFocus:!0})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ìƒ‰ìƒ"}),a.jsxs("div",{className:"color-picker-wrapper",style:{display:"flex",alignItems:"center",gap:"8px"},children:[a.jsx("input",{type:"color",value:b,onChange:e=>N(e.target.value),style:{width:"40px",height:"40px",padding:"0",border:"none",cursor:"pointer"}}),a.jsx("span",{className:"color-value",style:{fontSize:"13px",color:"#666"},children:b})]})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"ì—°ê²°í•  ì´ë²¤íŠ¸ ì¹´í…Œê³ ë¦¬"}),a.jsxs("select",{value:y||"",onChange:e=>j(e.target.value?parseInt(e.target.value):null),children:[a.jsx("option",{value:"",children:"-- ì„ íƒ ì•ˆ í•¨ --"}),null==t?void 0:t.map(e=>a.jsx("option",{value:e.id,children:e.name},e.id))]})]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{className:"btn-save",onClick:C,children:"ì €ìž¥"}),a.jsx("button",{className:"btn-cancel",onClick:S,children:"ì·¨ì†Œ"})]})]},e.id):a.jsxs("div",{className:"todo-category-item",children:[a.jsxs("div",{className:"todo-category-info",children:[a.jsxs("span",{className:"todo-category-name",style:{display:"flex",alignItems:"center",gap:"8px"},children:[a.jsx("span",{className:"category-color-dot",style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:e.color||"#4a9eff",display:"inline-block"}}),e.name]}),e.event_category_id&&k(e.event_category_id)&&a.jsxs("span",{className:"linked-event-category",children:["â†’ ",k(e.event_category_id).name,a.jsx("span",{className:"category-color-dot",style:{backgroundColor:k(e.event_category_id).color}})]})]}),a.jsxs("div",{className:"category-actions",children:[a.jsx("button",{className:"btn-edit",onClick:()=>(e=>{g(e.id),f(e.name),j(e.event_category_id||null),N(e.color||"#4a9eff")})(e),children:"ìˆ˜ì •"}),a.jsx("button",{className:"btn-delete",onClick:()=>l(e.id),children:"ì‚­ì œ"})]})]},e.id))})]})}function k({currentDate:n,setCurrentDate:s}){const[l,r]=o.useState(!1),[i,c]=o.useState(!1),[u,m]=o.useState([]),{dailyData:h,addTodo:x,updateTodo:y,deleteTodo:k,reorderTodos:w,updateRoutineCheck:_,addRoutine:D,updateRoutine:T,deleteRoutine:E,reorderRoutines:M,saveData:$,addImageToState:I,removeImageFromState:R}=function(a){const[n,s]=o.useState({todos:[],reflection:"",mood:null,images:[],routines:[],routineChecks:{}}),[l,r]=o.useState(!0),i=e(a),c=o.useCallback(async()=>{r(!0);try{const e=await t.getDailyData(i);e.success&&s(e.data)}catch(e){}finally{r(!1)}},[i]);return o.useEffect(()=>{c()},[c]),{dailyData:n,loading:l,saveData:o.useCallback(async e=>{s(t=>({...t,...e}));try{await t.saveDailyData(i,e)}catch(a){await c()}},[i,c]),addImageToState:o.useCallback(e=>{s(t=>({...t,images:[...t.images||[],e]}))},[]),removeImageFromState:o.useCallback(e=>{s(t=>({...t,images:(t.images||[]).filter(t=>t.id!==e)}))},[]),addTodo:o.useCallback(async(e,a,n,s,o)=>{(await t.addTodo(i,e,a,n,s,o)).success&&await c()},[i,c]),updateTodo:o.useCallback(async(e,a)=>{(await t.updateTodo(e,a)).success&&await c()},[c]),deleteTodo:o.useCallback(async e=>{(await t.deleteTodo(e)).success&&await c()},[c]),reorderTodos:o.useCallback(async e=>{(await t.reorderTodos(e)).success&&await c()},[c]),updateRoutineCheck:o.useCallback(async(e,a)=>{(await t.updateRoutineCheck(i,e,a)).success&&s(t=>({...t,routineChecks:{...t.routineChecks,[e]:a}}))},[i]),addRoutine:o.useCallback(async e=>{(await t.addRoutine(e)).success&&await c()},[c]),updateRoutine:o.useCallback(async(e,a)=>{(await t.updateRoutine(e,a)).success&&await c()},[c]),deleteRoutine:o.useCallback(async e=>{(await t.deleteRoutine(e)).success&&await c()},[c]),reorderRoutines:o.useCallback(async e=>{(await t.reorderRoutines(e)).success&&await c()},[c]),reload:c}}(n),{categories:P,events:A,loading:z,reloadCategories:F,createEvent:B,updateEvent:L,deleteEvent:O,getWakeSleepTimes:U}=function(a){const[n,s]=o.useState([]),[l,r]=o.useState([]),[i,c]=o.useState(!0),u=e(a),m=o.useCallback(async()=>{try{const e=await t.getCategories();e.success&&s(e.categories)}catch(e){}},[]);o.useEffect(()=>{m()},[m]),o.useEffect(()=>{p()},[u]);const p=async()=>{const e=d.get(u);if(e&&Date.now()-e.timestamp<3e5)return r(e.events),void c(!1);c(!0);try{const[e,a]=await Promise.all([t.getEvents(u),t.getWakeSleepEvents(u)]);let n=[];e.success&&(n=e.events),d.set(u,{events:n,wakeSleepInfo:a.success?a:{},timestamp:Date.now()}),r(n)}catch(a){}finally{c(!1)}},h=o.useCallback(async(e,a,n,s,o=!1,l="",i=null)=>{try{const c=await t.createEvent(u,e,a,n,s,o,l,i);if(c.success)return r(e=>[...e,c.event]),d.delete(u),c.event}catch(c){throw c}},[u]),x=o.useCallback(async(e,a)=>{try{const n=await t.updateEvent(e,a);if(n.success)return r(t=>t.map(t=>t.id===e?n.event:t)),d.delete(u),n.event}catch(n){throw n}},[u]),g=o.useCallback(async e=>{try{(await t.deleteEvent(e)).success&&(r(t=>t.filter(t=>t.id!==e)),d.delete(u))}catch(a){throw a}},[u]),v=o.useCallback(async()=>{d.delete(u),await p()},[u]),f=o.useCallback(()=>{const e=d.get(u);return e&&e.wakeSleepInfo?{wakeTime:e.wakeSleepInfo.wakeTime||"-",sleepTime:e.wakeSleepInfo.sleepTime||"-"}:{wakeTime:"-",sleepTime:"-"}},[u]);return{categories:n,events:l,loading:i,reload:v,reloadCategories:m,createEvent:h,updateEvent:x,deleteEvent:g,getWakeSleepTimes:f}}(n);o.useEffect(()=>{W()},[]);const W=async()=>{try{const e=await t.getTodoCategories();e.success&&m(e.data)}catch(e){}},Y=e=>{const t=new Date(n);t.setDate(t.getDate()+e),s(t)};return a.jsxs("div",{className:"main-container",children:[a.jsxs("div",{className:"left-panel",children:[a.jsxs("div",{className:"time-tracker-date-header",children:[a.jsx("button",{className:"date-nav-btn",onClick:()=>Y(-1),children:"â—€"}),a.jsx("div",{className:"current-date",children:(q=n,q.toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"short"}))}),a.jsx("button",{className:"date-nav-btn",onClick:()=>Y(1),children:"â–¶"})]}),a.jsx(p,{events:A,todos:h.todos,categories:P,todoCategories:u,loading:z,currentDate:n,onCreateEvent:B,onUpdateEvent:L,onDeleteEvent:O,getWakeSleepTimes:U})]}),a.jsxs("div",{className:"right-panel",children:[a.jsx(N,{events:A,categories:P,currentDate:n,onOpenSettings:()=>r(!0)}),a.jsx(v,{routines:h.routines,routineChecks:h.routineChecks,onToggle:_,onAdd:D,onUpdate:T,onDelete:E,onReorder:M}),a.jsx(g,{todos:h.todos,categories:P,todoCategories:u,currentDate:n,onAdd:x,onUpdate:y,onDelete:k,onReorder:w,onOpenTodoCategoryManager:()=>c(!0)}),a.jsx(f,{selectedMood:h.mood,onSelect:e=>$({mood:e})}),a.jsx(b,{currentDate:n,images:h.images||[],onImageUploaded:e=>{I(e)},onImageDeleted:e=>{R(e)}}),a.jsx(j,{value:h.reflection,onSave:e=>$({reflection:e})})]}),l&&a.jsx("div",{className:"modal-overlay",onClick:()=>r(!1),children:a.jsxs("div",{className:"modal-content category-manager-modal",onClick:e=>e.stopPropagation(),children:[a.jsx(C,{categories:P,onCategoriesChange:F}),a.jsx("button",{className:"btn-close-modal",onClick:()=>r(!1),children:"ë‹«ê¸°"})]})}),i&&a.jsx("div",{className:"modal-overlay",onClick:()=>c(!1),children:a.jsxs("div",{className:"modal-content category-manager-modal",onClick:e=>e.stopPropagation(),children:[a.jsx(S,{todoCategories:u,eventCategories:P,onAdd:async(e,a,n)=>{try{(await t.addTodoCategory(e,a,n)).success&&W()}catch(s){}},onUpdate:async(e,a,n,s)=>{try{(await t.updateTodoCategory(e,a,n,s)).success&&W()}catch(o){}},onDelete:async e=>{try{(await t.deleteTodoCategory(e)).success&&W()}catch(a){}}}),a.jsx("button",{className:"btn-close-modal",onClick:()=>c(!1),children:"ë‹«ê¸°"})]})})]});var q}const w=o.lazy(()=>function(e,t){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));a=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in c)return;c[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,n&&s.setAttribute("nonce",n),document.head.appendChild(s),t?new Promise((t,a)=>{s.addEventListener("load",t),s.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})}(()=>import("./monthly-BNm71v_F.js").then(e=>e.M),__vite__mapDeps([0,1])));function _(){const[e,t]=o.useState("daily"),[n,s]=o.useState(new Date),l=e=>{t(e)};return a.jsxs("div",{className:"App",children:[a.jsxs("div",{className:"header",children:[a.jsx("div",{className:"header-title",children:"ðŸ“… 2025 ì¼ê¸°ìž¥"}),a.jsx("div",{className:"header-actions",children:a.jsxs("div",{className:"date-selector",children:[a.jsx("button",{className:"date-nav-btn view-toggle-btn "+("daily"===e?"active":""),onClick:()=>l("daily"),children:"Daily"}),a.jsx("button",{className:"date-nav-btn view-toggle-btn "+("monthly"===e?"active":""),onClick:()=>l("monthly"),children:"Monthly"})]})})]}),a.jsx("div",{className:"view-container "+("daily"===e?"active":""),children:"daily"===e&&a.jsx(k,{currentDate:n,setCurrentDate:s})}),a.jsx("div",{className:"view-container "+("monthly"===e?"active":""),children:"monthly"===e&&a.jsx(o.Suspense,{fallback:a.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"ë¡œë”© ì¤‘..."}),children:a.jsx(w,{goToDate:e=>{const[a,n,o]=e.split("-").map(Number);s(new Date(a,n-1,o)),t("daily")}})})})]})}r.createRoot(document.getElementById("root")).render(a.jsx(l.StrictMode,{children:a.jsx(_,{})}));
